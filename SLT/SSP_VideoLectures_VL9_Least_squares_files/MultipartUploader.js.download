"use strict";var Panopto=Panopto||{};Panopto.BatchUpload=Panopto.BatchUpload||{},Panopto.BatchUpload.Data=Panopto.BatchUpload.Data||{},Panopto.BatchUpload.MultipartUploader=function(e){var o,t=0,a=1,n=2,r=3,i=4,l={},p=0;function s(e){var o=l[e],t=o.file,r=Panopto.Core.ServiceInterface.MultipartUploadManager.predictRemainingSeconds(e);_.extend(this,{BytesUploaded:o.bytesUploaded,Extension:o.ext,Id:e,IsInvalid:o.status===i,Name:o.name,PercentUploaded:o.bytesUploaded/t.size*100,RemainingTime:r>=0?moment().startOf("day").seconds(r).format("HH:mm:ss"):"",SessionCreated:!!o.sessionId,SessionId:o.sessionId||Panopto.Core.Constants.EmptyGuid,Size:t.size,UploadInProgress:o.status===a,UploadNearCompletion:o.status===a&&o.bytesUploaded===t.size,UploadCompleted:o.status===n})}var d=function(){var e=_.countBy(l,(function(e){return e.status}));Panopto.BatchUpload.FileList.updateProgress({Total:_.keys(l).length,Invalid:e[i]||0,NotStarted:e[t]||0,Uploading:e[a]||0,Complete:e[n]||0,Failed:e[r]||0})};e.setupDragDrop=function(a){o=a,Panopto.Core.ServiceInterface.SessionUploadManagement.setHost(window.location.origin),Panopto.Core.ServiceInterface.MultipartUploadManager.setThrottlingDelay(Panopto.features.webUIDelayWhileThrottling);var n=function(e){e.stopPropagation(),e.preventDefault()},r=function(e){n(e),o.toggleClass("drop-target-drag")};_.each(["mouseover","mouseleave","dragover"],(function(e){o.on(e,n)})),_.each(["dragenter","dragleave"],(function(e){o.on(e,r)}));var l=function(o){var a,n,r,l=o.originalEvent,u=l.target.files||l.dataTransfer.files;u.length>0&&(n=u,r=[],_.each(n,(function(o,a){var n,l;n={file:o,id:p++,name:Panopto.Core.StringHelpers.parseFilename(o.name),ext:Panopto.Core.StringHelpers.parseExtension(o.name),bytesUploaded:0,status:t},(!_.contains(Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS,"."+n.ext)||Panopto.features.uploadByteLimit&&o.size>Panopto.features.uploadByteLimit)&&(n.status=i),e.registerFile(n.id,n),(l=new s(n.id)).Index=a+1,r[a]=l})),d(),a=r,Panopto.BatchUpload.FileList.addFiles(a)),c.val(null)};o.on("drop",(function(e){r(e),l(e)}));var u=!1!==Panopto.BatchUpload.Data.currentFolder.canPassMultiple&&!(PanoptoCore.Browser.$_safari&&PanoptoCore.Browser.$_mobile&&PanoptoCore.Browser.$_versionNumber<8),c=$("<input />",{type:"file",multiple:u,accept:Panopto.Core.Constants.MEDIA_UPLOAD_EXTENSIONS.join(",")}).on("change",l).hide().insertAfter(o);Panopto.Core.UI.Handlers.button(o,(function(){c.click()}),{keyEvent:"keypress"})},e.registerFile=function(e,o){l[e]=o,d()},e.removeFile=function(e){delete l[e],d()},e.startUpload=function(e,o,t){var p=l[e],f=new Panopto.Core.CancellableRequest,U=new Panopto.Core.CancellableRequest;p.sessionId=o,t=t||$.noop;var P=function(a,i){p.status=a,Panopto.BatchUpload.FileList.updateFile(new s(e)),d(),a===n&&t(!0),a===r&&(Panopto.BatchUpload.FileList.handleImportError(e,o,i),t(!1))};return p.status!==i&&(P(a),f=Panopto.Core.ServiceInterface.SessionUploadManagement.openUpload({sessionId:o,filename:p.file.name,startTime:new Date},(function(o){p.uploadId=o.ID;var t=function(o){p.bytesUploaded=o,Panopto.BatchUpload.FileList.updateFile(new s(e))},a=function(){U=Panopto.Core.ServiceInterface.SessionUploadManagement.closeUpload(o,(function(){P(n)}),(function(){P(r,"Failed to close upload.")}))},i=function(){P(r,"Failed to upload file.")};Panopto.BatchUpload.Data.useV2Upload?c(o,p,e,P,t,a,i):u(o,p,e,t,a,i)}),(function(){P(r,"Failed to open upload.")}))),new Panopto.Core.CancellableRequest((function(){f.cancel(),U.cancel()}))},e.stopUpload=function(e,o){var a=l[e];a.status=t,a.bytesUploaded=0,d(),Panopto.Core.ServiceInterface.MultipartUploadManager.cancelUpload(e,o)},e.pauseUpload=function(e){},e.resumeUpload=function(e){},e.uploadStarted=function(e){return!!l[e]&&l[e].status!==t},e.uploadCompleted=function(e){return!!l[e]&&l[e].status===n},e.isInvalid=function(e){return!l[e]||l[e].status===i},e.getSessionId=function(e){return l[e]&&l[e].sessionId?l[e].sessionId:Panopto.Core.Constants.EmptyGuid},e.resetSessionId=function(e){var o=l[e];o&&(o.sessionId=null,Panopto.BatchUpload.FileList.updateFile(new s(e)))},e.setTargetText=function(e){o.find(".uploader-text").text(e)},e.setComponent=function(e,o){e.Simulate=o};var u=function(e,o,t,a,n,r){Panopto.Core.ServiceInterface.MultipartUploadManager.queueUpload({file:o.file,fileId:t,uploadUri:e.UploadTarget},a,n,r),Panopto.Core.ServiceInterface.MultipartUploadManager.upload()},c=function(e,o,t,a,n,i,l){var p={fileId:t,file:o.file,streamUpload:e,bytesUploaded:[],contentStoreOpenUrl:void 0,contentStoreFileId:void 0,contentStoreUploadId:void 0};Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.getOpenContentStoreUploadUrl(p,(function(e){p.contentStoreOpenUrl=e.SignedUrl,p.contentStoreFileId=e.FileID,p.contentStoreUploadId=e.contentStoreUploadId,Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.queueUpload(p,n,i,l),Panopto.Core.ServiceInterface.UploadV2.MultipartUploadManager.upload()}),(function(){a(r,"Failed to upload file.")}))};return e}(Panopto.BatchUpload.MultipartUploader||{});
//# sourceMappingURL=file://seasyn/jenkinsbuilds/rel_rtc_13.6.0/13.6.0.00015/_PublishedWebsites/WebUI/Scripts/Panopto/BatchUpload/MultipartUploader.js.map
